<!DOCTYPE html>
<html>
<head>
<title>NOVUS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* DESIGN NOT CHANGED */
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background: linear-gradient(135deg, #e0c3fc, #8ec5fc);
}
.card{
    width:440px;
    background:white;
    padding:35px;
    border-radius:20px;
    box-shadow:0 15px 40px rgba(0,0,0,0.12);
}
h1{text-align:center;margin-bottom:5px;font-size:30px;color:#6a5acd;}
.sub{text-align:center;font-size:13px;color:#6b7280;margin-bottom:20px;}
label{font-size:13px;font-weight:500;}
input, select{
    width:100%;padding:10px;margin:8px 0 14px 0;
    border-radius:10px;border:1px solid #e5e7eb;
    font-size:14px;background:#f9fafb;
}
button{
    width:100%;padding:11px;border:none;border-radius:10px;
    font-weight:500;cursor:pointer;
}
.primary-btn{
    background: linear-gradient(270deg, #6a5acd, #8a2be2);
    color:white;
}
.links{text-align:center;margin-top:12px;font-size:13px;}
.links span{display:block;margin-top:6px;color:#6a5acd;cursor:pointer;}
.hidden{display:none;}
</style>
</head>

<body>

<div class="card">

<!-- LOGIN -->
<div id="loginForm">
<h1>NOVUS</h1>
<div class="sub">Maverick Onboarding System</div>

<label>Login As</label>
<select id="loginRole">
<option value="fresher">Fresher</option>
<option value="admin">Admin</option>
</select>

<label>Official Email</label>
<input type="email" id="loginEmail">

<label>Password</label>
<input type="password" id="loginPassword">

<button class="primary-btn" onclick="login()">Sign In</button>

<div class="links">
<span onclick="showCreate()">Sign Up</span>
</div>
</div>

<!-- SIGN UP -->
<div id="createForm" class="hidden">
<h1>NOVUS</h1>
<div class="sub">Create Account</div>

<label>Full Name</label>
<input type="text" id="fullName">

<label>Official Email</label>
<input type="email" id="signupEmail">

<label>Create Password</label>
<input type="password" id="signupPassword">

<label>Confirm Password</label>
<input type="password" id="confirmPassword">

<label>Role</label>
<select id="signupRole">
<option value="fresher">Fresher</option>
<option value="admin">Admin</option>
</select>

<button class="primary-btn" onclick="signup()">Create Account</button>

<div class="links">
<span onclick="showLogin()">Back to Login</span>
</div>
</div>

</div>

<script>
function showCreate(){
loginForm.classList.add("hidden");
createForm.classList.remove("hidden");
}
function showLogin(){
loginForm.classList.remove("hidden");
createForm.classList.add("hidden");
}
</script>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import { getFirestore, doc, setDoc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDPe0Zp69bnM9251w0FfnH1UPhGedGh4qo",
  authDomain: "novus-9dfb8.firebaseapp.com",
  projectId: "novus-9dfb8",
  storageBucket: "novus-9dfb8.firebasestorage.app",
  messagingSenderId: "641276518161",
  appId: "1:641276518161:web:ee2c11e2662e86e59bb6b0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);


// SIGNUP (FIXED — USING UID)
window.signup = async function() {

  const name = fullName.value;
  const email = signupEmail.value;
  const password = signupPassword.value;
  const confirmPassword = confirmPassword.value;
  const role = signupRole.value;

  if(password !== confirmPassword){
    alert("Passwords do not match!");
    return;
  }

  const userCredential = await createUserWithEmailAndPassword(auth, email, password);
  const user = userCredential.user;

  await setDoc(doc(db, "users", user.uid), {
    name: name,
    email: email,
    role: role,
    onboardingPercentage: 0,
    assessmentPercentage: 0,
    certificationPercentage: 0,
    overallScore: 0,
    professionalSummary: "No Summary"
  });

  alert("Account Created Successfully!");
  showLogin();
}


// LOGIN (FIXED — USING UID)
window.login = async function() {

  const email = loginEmail.value;
  const password = loginPassword.value;
  const selectedRole = loginRole.value;

  const userCredential = await signInWithEmailAndPassword(auth, email, password);
  const user = userCredential.user;

  const docSnap = await getDoc(doc(db, "users", user.uid));

  if(docSnap.exists()){

    const actualRole = docSnap.data().role;

    if(actualRole !== selectedRole){
      alert("Wrong role selected!");
      return;
    }

    if(actualRole === "admin"){
      window.location.href = "AdminDashboard.html";
    } else {
      window.location.href = "FresherDashboard.html";
    }

  } else {
    alert("User data not found!");
  }
}

</script>

</body>
</html>
