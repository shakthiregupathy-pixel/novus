<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDPe0Zp69bnM9251w0FfnH1UPhGedGh4qo",
  authDomain: "novus-9dfb8.firebaseapp.com",
  projectId: "novus-9dfb8",
  storageBucket: "novus-9dfb8.firebasestorage.app",
  messagingSenderId: "641276518161",
  appId: "1:641276518161:web:ee2c11e2662e86e59bb6b0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {

if(user){

    // ðŸ”¹ USERS COLLECTION (existing logic)
    const userDoc = await getDoc(doc(db,"users",user.uid));

    if(userDoc.exists()){

        const data = userDoc.data();

        document.getElementById("displayName").innerText = data.name || "No Name";
        document.getElementById("displayEmail").innerText = user.email;
        document.getElementById("displaySummary").innerText = data.professionalSummary || "No Summary";

        document.getElementById("onboardingPercent").innerText = (data.onboardingPercentage || 0) + "%";
        document.getElementById("assessmentPercent").innerText = (data.assessmentPercentage || 0) + "%";
        document.getElementById("certPercent").innerText = (data.certificationPercentage || 0) + "%";
        document.getElementById("overallPercent").innerText = (data.overallScore || 0) + "%";

        const firstLetter = data.name ? data.name.charAt(0).toUpperCase() : "U";
        document.getElementById("avatarInitial").innerText = firstLetter;
        document.getElementById("topInitial").innerText = firstLetter;
    }

    // ðŸ”¹ AGENTS COLLECTION (EMPID FETCH)
    const agentDoc = await getDoc(doc(db,"agents",user.email));

    if(agentDoc.exists()){
        const empId = agentDoc.data().EMPID || "Not Assigned";

        // If element exists, show EMPID safely
        const empElement = document.getElementById("displayEmpId");
        if(empElement){
            empElement.innerText = empId;
        }
    }

}else{
    window.location.href="Novus_login.html";
}

});
</script>
